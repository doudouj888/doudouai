<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>申请入驻席位</title>

  <!-- Tailwind CDN：无需安装 -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { background: linear-gradient(180deg, #f8fafc 0%, #eef6ff 100%); }
  </style>
</head>

<body class="min-h-screen text-slate-900">

  <!-- 版本标记（防缓存） -->
  <div class="text-left text-xs text-red-600 px-6 pt-2">VERSION: V4</div>

  <!-- JS 运行标记（右上角） -->
  <div id="jsFlag"
       style="position:fixed;top:10px;right:10px;z-index:99999;background:#22c55e;color:#fff;padding:6px 10px;border-radius:8px;font-size:12px;">
    JS 未运行
  </div>

  <!-- 顶部栏 -->
  <header class="h-14 px-6 flex items-center justify-between">
    <div class="flex items-center gap-2 font-semibold">
      <div class="h-8 w-8 rounded-lg bg-slate-900 text-white grid place-items-center text-sm">DD</div>
      <span>ChatGPT Business</span>
    </div>
    <div class="text-xs text-slate-500 hidden sm:block">
      累计已服务 11,800+ 团队与个人开发者
    </div>
  </header>

  <main class="px-4 pb-28">
    <div class="max-w-[440px] mx-auto mt-10">
      <div class="rounded-2xl bg-white shadow-[0_8px_30px_rgba(2,6,23,0.08)] border border-slate-100 overflow-hidden">
        <!-- 顶部蓝线 -->
        <div class="h-1 bg-slate-200">
          <div class="h-full w-2/3 bg-blue-500"></div>
        </div>

        <div class="p-8">
          <h1 class="text-xl font-semibold text-center">申请入驻席位</h1>
          <p class="mt-2 text-center text-sm text-slate-500 leading-relaxed">
            官方正规渠道，独立订阅账号。<br/>
            如未持有兑换码，请点击页面下方 <span class="text-blue-600">联系客服经理</span> 获取。
          </p>

          <!-- 表单 -->
          <div class="mt-8 space-y-4">
            <div>
              <div class="text-sm font-semibold text-slate-700 mb-2">内部兑换码</div>
              <div class="h-12 rounded-xl border border-slate-200 bg-slate-50 px-4 flex items-center gap-3">
                <span class="text-slate-400">🔒</span>
                <input id="inviteCode"
                       placeholder="INVITE-CODE"
                       class="w-full bg-transparent outline-none text-sm"
                       autocomplete="off" />
              </div>
            </div>

            <div>
              <div class="text-sm font-semibold text-slate-700 mb-2">接收邮箱</div>
              <div class="h-12 rounded-xl border border-slate-200 bg-slate-50 px-4 flex items-center gap-3">
                <span class="text-slate-400">✉️</span>
                <input id="email"
                       placeholder="必须填写 GPT 登录邮箱"
                       class="w-full bg-transparent outline-none text-sm"
                       inputmode="email"
                       autocomplete="email" />
              </div>
            </div>

            <label class="flex items-start gap-3 text-xs text-slate-600 select-none">
              <input id="confirm" type="checkbox" class="mt-0.5 h-4 w-4 rounded border-slate-300"/>
              <span>我已确认邮箱填写正确，若填写错误可能导致名额作废且无法找回。</span>
            </label>

            <!-- 按钮：不写 disabled，完全交给 JS 控制 -->
            <button id="submitBtn"
              class="w-full h-12 rounded-xl font-semibold transition bg-slate-200 text-slate-500 cursor-not-allowed">
              立即兑换席位
            </button>

            <!-- debug：按钮下面红字 -->
            <div id="debug" class="text-xs text-red-500 mt-2"></div>

            <p class="text-[11px] text-center text-slate-500">
              提交即代表你已阅读并同意本页的服务说明及售后条款。
            </p>

            <!-- 保障折叠 -->
            <div class="rounded-xl border border-slate-100 bg-slate-50">
              <button id="toggleGuarantee" class="w-full px-4 py-3 flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="h-8 w-8 rounded-full bg-emerald-100 grid place-items-center">🛡️</div>
                  <div class="text-left">
                    <div class="text-sm font-semibold">无忧售后保障</div>
                    <div class="text-xs text-slate-500">30天质保，包含全额退款承诺</div>
                  </div>
                </div>
                <span id="arrow" class="text-slate-500">▾</span>
              </button>

              <div id="guarantee" class="hidden px-4 pb-4 text-xs text-slate-600 leading-relaxed">
                <ul class="space-y-2 pl-1">
                  <li>✅ 兑换失败/不可用：按规则处理退款或补发</li>
                  <li>✅ 席位异常：协助排查绑定邮箱、权限和订阅状态</li>
                  <li>✅ 响应时效：工作时段优先处理（示例文案）</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 底部悬浮（避免遮挡中间按钮：外层 pointer-events-none） -->
      <div class="fixed left-0 right-0 bottom-6 px-4 pointer-events-none">
        <div class="max-w-[440px] mx-auto">
          <div class="h-12 rounded-full bg-white/90 backdrop-blur border border-slate-200 shadow flex items-center justify-center gap-3 px-3 pointer-events-auto">
            <button id="contactBtn"
              class="h-9 px-4 rounded-full bg-slate-900 text-white text-sm font-semibold flex items-center gap-2">
              <span class="h-2 w-2 rounded-full bg-emerald-400"></span> 客户经理
            </button>
            <button class="h-9 w-9 rounded-full border border-slate-200 bg-white hover:bg-slate-50">🛡️</button>
            <button class="h-9 w-9 rounded-full border border-slate-200 bg-white hover:bg-slate-50">✈️</button>
          </div>
        </div>
      </div>

    </div>
  </main>

  <script>
    // ========== 基本配置 ==========
    const API = "https://fmu.928683877.xyz/api/redeem";

    // 右上角标记：证明 JS 已运行
    const flag = document.getElementById("jsFlag");
    if (flag) flag.textContent = "JS 运行中 ✅";

    // 取元素
    const btn = document.getElementById("submitBtn");
    const inviteCode = document.getElementById("inviteCode");
    const email = document.getElementById("email");
    const confirmBox = document.getElementById("confirm");
    const debug = document.getElementById("debug");

    function isValidEmail(v) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((v || "").trim());
    }

    function refresh() {
      const code = (inviteCode.value || "").trim();
      const em = (email.value || "").trim();
      const ok = code.length > 0 && isValidEmail(em) && confirmBox.checked;

      btn.disabled = !ok;
      btn.className = ok
        ? "w-full h-12 rounded-xl font-semibold transition bg-slate-900 text-white hover:bg-slate-800"
        : "w-full h-12 rounded-xl font-semibold transition bg-slate-200 text-slate-500 cursor-not-allowed";

      debug.textContent = ok
        ? "✅ 已满足条件，可以提交"
        : "❌ 未满足条件：" +
          (code.length > 0 ? "" : "【邀请码】") +
          (isValidEmail(em) ? "" : "【邮箱】") +
          (confirmBox.checked ? "" : "【勾选】");
    }

    // 绑定事件
    ["input", "change", "keyup", "blur"].forEach((evt) => {
      inviteCode.addEventListener(evt, refresh);
      email.addEventListener(evt, refresh);
      confirmBox.addEventListener(evt, refresh);
    });

    // 初次刷新
    refresh();

    // 点击提交：调用 Worker
    btn.addEventListener("click", async () => {
      if (btn.disabled) return;

      btn.textContent = "提交中...";
      btn.disabled = true;

      try {
        const res = await fetch(API, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
           code: inviteCode.value.trim(),
           email: email.value.trim(),
          }),
        });

        const data = await res.json().catch(() => ({}));
        if (!res.ok) {
          alert(data.message || "兑换失败：请求错误");
          return;
        }

        alert("兑换成功：" + (data.message || "OK"));
      } catch (e) {
        alert("网络错误：请稍后再试");
      } finally {
        btn.textContent = "立即兑换席位";
        btn.disabled = false;
        refresh();
      }
    });

    // 保障折叠
    const toggle = document.getElementById("toggleGuarantee");
    const guarantee = document.getElementById("guarantee");
    const arrow = document.getElementById("arrow");
    toggle.addEventListener("click", () => {
      const isHidden = guarantee.classList.contains("hidden");
      guarantee.classList.toggle("hidden");
      arrow.textContent = isHidden ? "▴" : "▾";
    });

    // 客服按钮
    document.getElementById("contactBtn").addEventListener("click", () => {
      alert("这里后续换成你的客服链接/微信二维码");
    });
  </script>

</body>
</html>
