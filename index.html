<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>申请入驻席位</title>

  <!-- Tailwind CDN：无需安装 -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { background: linear-gradient(180deg, #f8fafc 0%, #eef6ff 100%); }
  </style>
</head>
<!-- 居中弹窗 Modal（增强版） -->
<div id="modal" class="fixed inset-0 z-[99999] hidden">
  <!-- 遮罩 -->
  <div id="modalBackdrop"
       class="absolute inset-0 bg-black/40 opacity-0 transition-opacity duration-150"></div>

  <!-- 弹窗主体 -->
  <div class="relative min-h-screen flex items-center justify-center p-4">
    <div id="modalCard"
         class="w-full max-w-[420px] rounded-2xl bg-white shadow-xl border border-slate-100
                opacity-0 scale-95 transition duration-150">
      <div class="p-6">
        <div class="flex items-start gap-3">
          <!-- 图标 -->
          <div id="modalIcon"
               class="h-10 w-10 rounded-full flex items-center justify-center text-lg bg-slate-100">
            i
          </div>

          <div class="min-w-0 flex-1">
            <div id="modalTitle" class="text-lg font-semibold text-slate-900">提示</div>
            <div id="modalMsg" class="mt-1 text-sm text-slate-600 leading-relaxed">...</div>
          </div>
        </div>

        <div class="mt-6 flex justify-end gap-3">
          <button id="modalCloseBtn"
                  class="h-10 px-4 rounded-xl border border-slate-200 bg-white hover:bg-slate-50 text-sm font-semibold">
            关闭
          </button>
          <button id="modalOkBtn"
                  class="h-10 px-4 rounded-xl bg-slate-900 text-white hover:bg-slate-800 text-sm font-semibold">
            确定
          </button>
        </div>

        <div class="mt-3 text-xs text-slate-400">
          提示：按 ESC 也可以关闭
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 顶部居中横条提示（Top Banner） -->
<div id="topBanner" class="fixed top-6 left-1/2 -translate-x-1/2 z-[99999] hidden">
  <div id="topBannerInner"
       class="flex items-center gap-3 rounded-full px-5 py-3 shadow-lg border bg-emerald-500 text-white border-emerald-400">
    <!-- 对勾 -->
    <div class="h-7 w-7 rounded-full flex items-center justify-center bg-white/20">
      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="3">
        <path d="M20 6L9 17l-5-5"></path>
      </svg>
    </div>

    <div id="topBannerMsg" class="text-sm font-semibold whitespace-nowrap">
      已复制！
    </div>
  </div>
</div>


<body class="min-h-screen text-slate-900">
  <!-- 顶部栏 -->
  <header class="h-14 px-6 flex items-center justify-between">
    <div class="flex items-center gap-2 font-semibold">
      <div class="h-8 w-8 rounded-lg bg-slate-900 text-white grid place-items-center text-sm">DD</div>
      <span>ChatGPT Business</span>
    </div>
    <div class="text-xs text-slate-500 hidden sm:block">
      累计已服务 11,800+ 团队与个人开发者
    </div>
  </header>

  <main class="px-4 pb-28">
    <div class="max-w-[440px] mx-auto mt-10">
      <div class="rounded-2xl bg-white shadow-[0_8px_30px_rgba(2,6,23,0.08)] border border-slate-100 overflow-hidden">
        <!-- 顶部蓝线 -->
        <div class="h-1 bg-slate-200">
          <div class="h-full w-2/3 bg-blue-500"></div>
        </div>

        <div class="p-8">
          <h1 class="text-xl font-semibold text-center">申请入驻席位</h1>
          <p class="mt-2 text-center text-sm text-slate-500 leading-relaxed">
            官方正规渠道，独立订阅账号。<br/>
            如未持有兑换码，请点击页面下方 <span class="text-blue-600">联系客户经理</span> 获取。
          </p>

          <!-- 表单 -->
          <div class="mt-8 space-y-4">
            <div>
              <div class="text-sm font-semibold text-slate-700 mb-2">内部兑换码</div>
              <div class="h-12 rounded-xl border border-slate-200 bg-slate-50 px-4 flex items-center gap-3">
                <span class="text-slate-400">🔒</span>
                <input id="inviteCode"
                       placeholder="INVITE-CODE"
                       class="w-full bg-transparent outline-none text-sm"
                       autocomplete="off" />
              </div>
            </div>

            <div>
              <div class="text-sm font-semibold text-slate-700 mb-2">接收邮箱</div>
              <div class="h-12 rounded-xl border border-slate-200 bg-slate-50 px-4 flex items-center gap-3">
                <span class="text-slate-400">✉️</span>
                <input id="email"
                       placeholder="必须填写 GPT 登录邮箱"
                       class="w-full bg-transparent outline-none text-sm"
                       inputmode="email"
                       autocomplete="email" />
              </div>
            </div>

            <label class="flex items-start gap-3 text-xs text-slate-600 select-none">
              <input id="confirm" type="checkbox" class="mt-0.5 h-4 w-4 rounded border-slate-300"/>
              <span>我已确认邮箱填写正确，若填写错误可能导致名额作废且无法找回。</span>
            </label>

            <!-- 按钮：不写 disabled，完全交给 JS 控制 -->
            <button id="submitBtn"
              class="w-full h-12 rounded-xl font-semibold transition bg-slate-200 text-slate-500 cursor-not-allowed">
              立即兑换席位
            </button>

            <!-- debug：按钮下面红字 -->
            <div id="debug" class="text-xs text-red-500 mt-2"></div>

            <p class="text-[11px] text-center text-slate-500">
              提交即代表你已阅读并同意本页的服务说明及售后条款。
            </p>

            <!-- 保障折叠 -->
            <div class="rounded-xl border border-slate-100 bg-slate-50">
              <button id="toggleGuarantee" class="w-full px-4 py-3 flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="h-8 w-8 rounded-full bg-emerald-100 grid place-items-center">🛡️</div>
                  <div class="text-left">
                    <div class="text-sm font-semibold">无忧售后保障</div>
                    <div class="text-xs text-slate-500">30天质保，从不翻车</div>
                  </div>
                </div>
                <span id="arrow" class="text-slate-500">▾</span>
              </button>

              <div id="guarantee" class="hidden px-4 pb-4 text-xs text-slate-600 leading-relaxed">
                <ul class="space-y-2 pl-1">
                  <li>✅ 兑换失败/不可用：按规则处理退款或补发</li>
                  <li>✅ 席位异常：协助排查绑定邮箱、权限和订阅状态</li>
                  <li>✅ 响应时效：工作时段优先处理（示例文案）</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 底部悬浮（避免遮挡中间按钮：外层 pointer-events-none） -->
      <div class="fixed left-0 right-0 bottom-6 px-4 pointer-events-none">
        <div class="max-w-[440px] mx-auto">
          <div class="h-12 rounded-full bg-white/90 backdrop-blur border border-slate-200 shadow flex items-center justify-center gap-3 px-3 pointer-events-auto">
            <div
  class="h-9 px-3
         flex items-center gap-2
         text-slate-500
         text-xs
         select-none">
  <span class="h-2 w-2 rounded-full bg-emerald-400"></span>
  客户经理在线
</div>


            <!-- QQ -->
<button id="qqBtn"
  title="复制 QQ"
  class="h-9 w-9 rounded-full border border-slate-200 bg-white hover:bg-slate-50 flex items-center justify-center">
  <!-- QQ 图标（简洁版） -->
  <svg viewBox="0 0 1024 1024" width="18" height="18" fill="#12B7F5">
    <path d="M511.9 64C282.7 64 96 250.7 96 479.9c0 135.6 68.6 255.3 173.3 327.2-2.1 9.4-13.1 59.8-2.6 79.2 0 0 9.2 13.5 27.6 0 18.4-13.5 54.7-39.6 84.5-44.9 43.6 12.2 90.3 18.8 139.7 18.8 49.5 0 96.1-6.6 139.7-18.8 29.8 5.3 66.1 31.4 84.5 44.9 18.4 13.5 27.6 0 27.6 0 10.5-19.4-0.5-69.8-2.6-79.2C859.4 735.2 928 615.5 928 479.9 928 250.7 741.3 64 511.9 64z"/>
  </svg>
</button>

<!-- 微信 -->
<button id="wechatBtn"
  title="复制微信"
  class="h-9 w-9 rounded-full border border-slate-200 bg-white hover:bg-slate-50 flex items-center justify-center">
  <!-- 微信图标 -->
  <svg viewBox="0 0 1024 1024" width="18" height="18" fill="#07C160">
    <path d="M512 64C264.6 64 64 240.5 64 458.7c0 125.2 73.6 235.7 188.7 306.2l-30.3 94.2c-3.3 10.3 7.9 19.6 17.6 14.4l112.7-61.4c50.6 14.1 104.5 21.8 159.3 21.8 247.4 0 448-176.5 448-394.7S759.4 64 512 64z"/>
  </svg>
</button>

          </div>
        </div>
      </div>

    </div>
  </main>

  <script>
/* ================== 配置 ================== */
const API = "/api/friend-redeem";

/* ================== DOM 元素 ================== */
const inviteCodeEl = document.getElementById("inviteCode");
const emailEl = document.getElementById("email");
const confirmEl = document.getElementById("confirm");
const submitBtn = document.getElementById("submitBtn");

// Modal 元素（必须存在于 HTML）
const modalEl = document.getElementById("modal");
const modalCardEl = document.getElementById("modalCard");
const modalBackdropEl = document.getElementById("modalBackdrop");
const modalIconEl = document.getElementById("modalIcon");
const modalTitleEl = document.getElementById("modalTitle");
const modalMsgEl = document.getElementById("modalMsg");
const modalCloseBtnEl = document.getElementById("modalCloseBtn");
const modalOkBtnEl = document.getElementById("modalOkBtn");

/* ================== 工具 ================== */
function isValidEmail(v) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((v || "").trim());
}

/* ================== Modal（增强版） ================== */
let modalShown = false;

function showModal(type, title, msg, options = {}) {
  // 如果 modal 结构缺失，就退化为 alert（防止你页面少了 HTML 导致“没反应”）
  if (!modalEl || !modalCardEl || !modalBackdropEl || !modalTitleEl || !modalMsgEl) {
    alert(`${title || "提示"}\n${msg || ""}`);
    if (typeof options.onClose === "function") options.onClose();
    return;
  }

  modalTitleEl.textContent = title || (type === "success" ? "成功" : "失败");
  modalMsgEl.textContent = msg || "";

  // 成功/失败样式
  if (type === "success") {
    if (modalIconEl) {
      modalIconEl.textContent = "✓";
      modalIconEl.className =
        "h-10 w-10 rounded-full flex items-center justify-center text-lg bg-emerald-100 text-emerald-700";
    }
    modalTitleEl.className = "text-lg font-semibold text-emerald-700";
    modalCardEl.className =
      "w-full max-w-[420px] rounded-2xl bg-white shadow-xl border border-emerald-200 opacity-0 scale-95 transition duration-150";
  } else if (type === "error") {
    if (modalIconEl) {
      modalIconEl.textContent = "!";
      modalIconEl.className =
        "h-10 w-10 rounded-full flex items-center justify-center text-lg bg-red-100 text-red-700";
    }
    modalTitleEl.className = "text-lg font-semibold text-red-700";
    modalCardEl.className =
      "w-full max-w-[420px] rounded-2xl bg-white shadow-xl border border-red-200 opacity-0 scale-95 transition duration-150";
  } else {
    if (modalIconEl) {
      modalIconEl.textContent = "i";
      modalIconEl.className =
        "h-10 w-10 rounded-full flex items-center justify-center text-lg bg-slate-100 text-slate-700";
    }
    modalTitleEl.className = "text-lg font-semibold text-slate-900";
    modalCardEl.className =
      "w-full max-w-[420px] rounded-2xl bg-white shadow-xl border border-slate-100 opacity-0 scale-95 transition duration-150";
  }

  modalEl.classList.remove("hidden");
  modalShown = true;

  // 动画
  requestAnimationFrame(() => {
    modalBackdropEl.classList.remove("opacity-0");
    modalBackdropEl.classList.add("opacity-100");

    modalCardEl.classList.remove("opacity-0", "scale-95");
    modalCardEl.classList.add("opacity-100", "scale-100");
  });

  // 存关闭回调（例如：成功后清空表单）
  modalEl.__onClose = options.onClose || null;
}

function hideModal() {
  if (!modalShown || !modalEl) return;

  // 退出动画
  if (modalBackdropEl) {
    modalBackdropEl.classList.remove("opacity-100");
    modalBackdropEl.classList.add("opacity-0");
  }
  if (modalCardEl) {
    modalCardEl.classList.remove("opacity-100", "scale-100");
    modalCardEl.classList.add("opacity-0", "scale-95");
  }

  setTimeout(() => {
    modalEl.classList.add("hidden");
    modalShown = false;

    // 关闭回调
    if (typeof modalEl.__onClose === "function") {
      try { modalEl.__onClose(); } catch {}
    }
    modalEl.__onClose = null;
  }, 170);
}

// 绑定关闭事件（元素不存在就跳过）
modalCloseBtnEl?.addEventListener("click", hideModal);
modalOkBtnEl?.addEventListener("click", hideModal);
modalBackdropEl?.addEventListener("click", hideModal);
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") hideModal();
});

/* ================== 表单状态控制 ================== */
function refresh() {
  if (!inviteCodeEl || !emailEl || !confirmEl || !submitBtn) return;

  const code = inviteCodeEl.value.trim();
  const em = emailEl.value.trim();
  const ok = code.length > 0 && isValidEmail(em) && confirmEl.checked;

  submitBtn.disabled = !ok;
  submitBtn.className = ok
    ? "w-full h-12 rounded-xl font-semibold transition bg-slate-900 text-white hover:bg-slate-800"
    : "w-full h-12 rounded-xl font-semibold transition bg-slate-200 text-slate-500 cursor-not-allowed";
}

// 输入变化就刷新按钮状态
["input", "change"].forEach((evt) => {
  inviteCodeEl?.addEventListener(evt, refresh);
  emailEl?.addEventListener(evt, refresh);
  confirmEl?.addEventListener(evt, refresh);
});

/* ================== 提交逻辑 ================== */
submitBtn?.addEventListener("click", async () => {
  if (!inviteCodeEl || !emailEl || !confirmEl || !submitBtn) return;
  if (submitBtn.disabled) return;

  // 上锁 & loading
  const oldText = submitBtn.textContent;
  submitBtn.disabled = true;
  submitBtn.textContent = "提交中...";

  try {
    const res = await fetch(API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        inviteCode: inviteCodeEl.value.trim(),
        email: emailEl.value.trim(),
      }),
    });

    const text = await res.text();
    let data = {};
    try { data = JSON.parse(text); } catch { data = { message: text }; }

    if (!res.ok) {
      showModal("error", "兑换失败", data.message || "请求失败");
      return;
    }

    // ✅ 成功弹窗（默认：关闭后清空表单）
    showModal("success", "兑换成功", data.message || "操作成功", {
      onClose: () => {
        inviteCodeEl.value = "";
        emailEl.value = "";
        confirmEl.checked = false;
        refresh();
      },
    });

  } catch (e) {
    showModal("error", "网络错误", "请稍后再试");
  } finally {
    submitBtn.textContent = oldText;
    refresh(); // 用 refresh() 恢复 disabled/样式
  }
});

/********************
 * 顶部横条提示
 ********************/
function showTopBanner(msg, type = "success") {
  const box = document.getElementById("topBanner");
  const inner = document.getElementById("topBannerInner");
  const text = document.getElementById("topBannerMsg");

  if (!box || !inner || !text) {
    console.warn("TopBanner DOM 未找到");
    return;
  }

  text.textContent = msg || "提示";

  if (type === "success") {
    inner.className =
      "flex items-center gap-3 rounded-full px-5 py-3 shadow-lg border bg-emerald-500 text-white border-emerald-400";
  } else {
    inner.className =
      "flex items-center gap-3 rounded-full px-5 py-3 shadow-lg border bg-red-500 text-white border-red-400";
  }

  box.classList.remove("hidden");

  clearTimeout(window.__topBannerTimer);
  window.__topBannerTimer = setTimeout(() => {
    box.classList.add("hidden");
  }, 2200);
}

/********************
 * 复制到剪切板（最终版）
 ********************/
async function copyTextAndNotify(text) {
  try {
    // 现代浏览器
    await navigator.clipboard.writeText(text);
    showTopBanner(`已复制！请打开QQ 添加好友：${1741402571}`, "success");
  } catch (e) {
    // 兜底方案（兼容老浏览器）
    const input = document.createElement("textarea");
    input.value = text;
    input.style.position = "fixed";
    input.style.left = "-9999px";
    document.body.appendChild(input);
    input.select();
    document.execCommand("copy");
    document.body.removeChild(input);

    showTopBanner(`已复制！请打开微信 添加好友：${ddyyds2024}`, "success");
  }
}

/********************
 * 顶部横条提示
 ********************/
function showTopBanner(msg, type = "success") {
  const box = document.getElementById("topBanner");
  const inner = document.getElementById("topBannerInner");
  const text = document.getElementById("topBannerMsg");

  if (!box || !inner || !text) return;

  text.textContent = msg;

  inner.className =
    "flex items-center gap-3 rounded-full px-5 py-3 shadow-lg border " +
    (type === "success"
      ? "bg-emerald-500 text-white border-emerald-400"
      : "bg-red-500 text-white border-red-400");

  box.classList.remove("hidden");

  clearTimeout(window.__topBannerTimer);
  window.__topBannerTimer = setTimeout(() => {
    box.classList.add("hidden");
  }, 2200);
}

/********************
 * 复制到剪切板（通用）
 ********************/
async function copyAndNotify(value, label) {
  try {
    await navigator.clipboard.writeText(value);
  } catch (e) {
    // 兜底兼容
    const input = document.createElement("textarea");
    input.value = value;
    input.style.position = "fixed";
    input.style.left = "-9999px";
    document.body.appendChild(input);
    input.select();
    document.execCommand("copy");
    document.body.removeChild(input);
  }

  showTopBanner(`已复制！请打开 ${label} 添加好友：${value}`, "success");
}

/********************
 * 绑定 QQ / 微信按钮（重点在这里）
 ********************/
window.addEventListener("DOMContentLoaded", () => {
  const QQ_NUMBER = "1741402571";        // ← 你的 QQ 号
  const WECHAT_ID = "ddyyds2024";    // ← 你的微信号

  const qqBtn = document.getElementById("qqBtn");
  const wechatBtn = document.getElementById("wechatBtn");

  if (qqBtn) {
    qqBtn.addEventListener("click", () => {
      copyAndNotify(QQ_NUMBER, "QQ");
    });
  }

  if (wechatBtn) {
    wechatBtn.addEventListener("click", () => {
      copyAndNotify(WECHAT_ID, "微信");
    });
  }
});

/* ================== 初始化 ================== */
refresh();
</script>


</body>
</html>
